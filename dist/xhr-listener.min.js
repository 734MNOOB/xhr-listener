/*! xhr-listener 09-07-2014 */
!function(){"use strict";Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null===this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),"function"!=typeof Object.create&&!function(){var a=function(){};Object.create=function(b){if(arguments.length>1)throw new Error("Second argument not supported");if(null===b)throw new Error("Cannot set a null [[Prototype]]");if("object"!=typeof b)throw new TypeError("Argument must be an object");return a.prototype=b,new a}}()}(window),function(a){"use strict";function b(a,c){if(!(this instanceof b)){var d=Object.create(b.prototype);return d.constructor.apply(d,arguments),d}this.path=a,c&&this.done(a,c)}function c(){var a=j(arguments),b=a[0],c=a[1],d=a[2],e={};if(!b||"function"==typeof b)return console.error("the type of request must be a string"),!1;if("function"==typeof c){if("undefined"==typeof this.path)return console.error("please define a path to track"),!1;d=c,c=this.path}else this.path=c;return"string"==typeof this.path||this.path instanceof RegExp?(e[c]=q[c]||{},e[c].path=c,e[c][b]=e[c][b]||[],e[c][b].push(d),void(q[c]=e[c])):(console.error("there is no path to track"),!1)}function d(){var a=this;g(function(b,c){if(c.done&&200===a.status){var d=m(a.getResponseHeader("Content-Type"));a.is=n(d),c.done.forEach(function(b){b.call(a,a.responseText,a.response,d),a.newResponseText&&k.call(a,"responseText"),a.newResponse&&k.call(a,"response")})}else c.error&&200!==a.status&&c.error.forEach(function(b){b.call(a,a.status,a.statusText)})},a.url)}function e(){var a=this;4===a.readyState&&d.apply(a,arguments)}function f(a){return g(!1,a)}function g(a,b){var c=!1;return h(function(d){i(d.path,b)&&(a&&a(d.path,d),c=!0)}),c}function h(a){var b;for(b in q)a(q[b])}function i(a,b){return"string"!=typeof a?a.test(b):a===b}function j(a){return Array.prototype.slice.call(a)}function k(a){var b=a,c="new"+b[0].toUpperCase()+b.slice(1),d=this[b];Object.defineProperty(this,b,{get:function(){return d},set:function(){return d=this[c]},configurable:!0}),this[b]=this[c]}function l(a,b){var c=this[a];try{Object.defineProperty(this,a,{get:function(){return c},set:function(a){return c=a,b.call(this,c),c},configurable:!0,writable:!0})}catch(d){return!1}}function m(a){return a.match("json")?"json":a.match("javascript")?"js":a.match("text")?"html":a.match("xml")?"xml":"text"}function n(a){return{html:"html"===a,json:"json"===a,js:"js"===a,text:"text"===a}}function o(a){var b={},c=!1;return a.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,d,e){b[d]=e,c=!0}),c?b:""}var p=function(){var b=a.XMLHttpRequest.prototype,c=["open","send"],d={};return d.proto=b,c.length||c.push("open"),c.forEach(function(a){d[a]=b[a]}),d}(),q={};b.prototype={constructor:b,onopen:function(a,b){c.call(this,"onopen",a,b)},done:function(a,b){c.call(this,"done",a,b)},error:function(a,b){c.call(this,"error",a,b)}},b.getRequestsList=function(){return q},p.proto.open=function(a,b){var c=this,d=arguments,h={onreadystatechange:!1};return c.url=b,f(c.url)?(c.params={get:o(b),post:{}},c.method=a.toLowerCase(),c.onreadystatechange&&(h.onreadystatechange=c.onreadystatechange),c.onreadystatechange=function(){e.apply(this,arguments),h.onreadystatechange&&h.onreadystatechange.apply(this,arguments)},l.call(c,"onreadystatechange",function(a){h.onreadystatechange=a}),g(function(a,b){b.onopen&&b.onopen.forEach(function(a){a.apply(c,d)})},b),p.open.apply(this,arguments)):p.open.apply(this,arguments)},p.proto.send=function(a){var b=this;return f(b.url)?(b.params.post=a?o(a):"",p.send.apply(b,arguments)):p.send.apply(b,arguments)},b.VERSION="0.0.1",a.XhrListener=b}(this);